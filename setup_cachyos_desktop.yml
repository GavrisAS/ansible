- hosts: localhost
  connection: local
  gather_facts: true

  vars:
    # –ü–∞–∫–µ—Ç—ã –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ Arch/CachyOS
    pacman_packages:
      - nvidia-dkms
      - docker
      - docker-compose
      - telegram-desktop
      - discord
      - flameshot
      - gramps
      - libreoffice-fresh
      - qbittorrent
      - texmaker
      - thunderbird
      - firefox
      - virtualbox
      - virtualbox-host-dkms
      - vlc
      - ruff
      - neovim
      - yt-dlp
      - ttf-font-awesome
      - otf-font-awesome
      - ttf-jetbrains-mono
      - github-cli
      - zed
      - ghostty
      - btop
      - eza
      - fd
      - yazi
      - ffmpeg
      - jq
      - ripgrep
      - fzf
      - zoxide
      - nerd-fonts
      - procs
      - duf
      - dust
      - lazygit
      - graphviz

    # –ü–∞–∫–µ—Ç—ã –∏–∑ AUR
    aur_packages:
      - lazydocker
      - lmstudio
      - obsidian
      - yandex-browser
      - warp-terminal
      - throne-bin
      - cursor-bin
      - slack-desktop
      - visual-studio-code-bin
      - zoom
      - peazip

  pre_tasks:
    - name: üëâ 0. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π CachyOS
      become: true
      pacman:
        name: cachyos-keyring
        state: latest

    - name: üëâ 0.1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
      become: true
      pacman:
        update_cache: yes

  tasks:
    - name: üëâ 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã
      become: true
      pacman:
        upgrade: yes

    - name: üëâ 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ 'base-devel' –¥–ª—è —Å–±–æ—Ä–∫–∏ AUR –ø–∞–∫–µ—Ç–æ–≤
      become: true
      pacman:
        name: base-devel
        state: present

    - name: üëâ 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ yay (AUR-—Ö–µ–ª–ø–µ—Ä)
      kewlfft.aur.aur:
        name: yay
        state: present
      become: false

    - name: üëâ 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
      become: true
      pacman:
        name: "{{ pacman_packages }}"
        state: present

    - name: üëâ 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ AUR —Å –ø–æ–º–æ—â—å—é yay
      kewlfft.aur.aur:
        use: yay
        name: "{{ aur_packages }}"
        state: present
      become: false

    - name: üëâ 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker
      become: true
      block:
        - name: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
          user:
            name: "{{ ansible_user_id }}"
            groups: docker
            append: yes

        - name: –í–∫–ª—é—á–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ Docker
          systemd:
            name: docker
            enabled: yes
            state: started

    - name: üëâ 7. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Rust
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id | default('ammo')) }}"
      shell: |
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
      args:
        creates: "{{ ansible_env.HOME }}/.cargo/bin/rustc"

    - name: üëâ 8. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ uv
      become: false
      become_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id | default('ammo')) }}"
      shell: |
        curl -LsSf https://astral.sh/uv/install.sh | sh
      args:
        creates: "{{ ansible_env.HOME }}/.local/bin/uv"

    - name: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      debug:
        msg: |
          ========================================================================
          ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

          ‚ÑπÔ∏è –í–ê–ñ–ù–û: –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è Docker, NVIDIA –∏ VirtualBox –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É,
          —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä.

          –î–ª—è VirtualBox –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è:
          sudo modprobe vboxdrv
          ========================================================================
